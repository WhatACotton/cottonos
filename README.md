# cottonos

Zynq プロセッサ用組み込み OS「cottonos」

現在開発中の組み込み OS です。ミニマルな OS を目指しています。

「KOZOS」をベースに参考にしながら、Zynq の環境に合わせた実装を行なっています。

[独自 OS を作ってみよう！](https://kozos.jp/kozos/)

## 進捗

### ~~Boot Loader~~

~~KOZOS では XMODEM を使用してファイル転送を行なっていますが、今回は SD カードにバイナリを書き込んで SD カードのデータを読み込んでブートさせるという方法を取っています。~~

Zynq の Stand Alone System においては、その実行環境の構築に FSBL を使用します。FSBL は、FPGA のビットストリームをロードし、ARM プロセッサを初期化して、バイナリを起動するためのブートローダーです。FSBL がブートローダの役割を果たすため、OS のブートローダーは必要ないことがわかりました(5/13)。

- [x] Block Design から Bitstream の生成・ハードウェアエクスポートの自動化
- [x] エクスポートされたハードウェア情報を元に Vitis のプロジェクトを自動生成
- [x] バイナリを`xilffs`ライブラリを用いた SD カードアクセス
- [x] `xilffs`を用いたファイル書き込み・読み込み
- [ ] 読み込んだ elf バイナリの実行

### OS

- [ ] 割り込みベースのスレッドを持つシステムの構築
- [ ] リアルタイム機能を実装(タイマ割り込み、多重割り込み)
- [ ] ネットワークスタックの開発
- [ ] SSL 機能の追加

### 応用

- [ ] FPGA の独自 IP モジュールを使用したシステムの実装

## 苦戦した点(そのうちドキュメントを書く予定のもの)

- bsp の設定を`xsct`から行う際、`xilffs`を読み込む設定

  書きました。
  [Vitis でライブラリを読み込む方法 - Vivado in CLI](https://my-xilinx-docs.pages.dev/blog/xilffs-in-xsct)

## `diff.sh`について

`/vitis`のディレクトリと`workspace`配下の`src`ディレクトリに差分があった場合に、`workspace`からファイルを転送するスクリプトです。git で管理する際に使います。
